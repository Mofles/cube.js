<div *ngIf="query">
  <div class="controls-container">
    <div class="controls-row">
      <members-group
        title="Measure"
        [members]="query.measures.asArray()"
        [allMembers]="builderMeta.measures"
        (onSelect)="query.measures.add($event)"
        (onMemberClick)="query.measures.remove($event)"
      ></members-group>

      <mat-divider [vertical]="true"></mat-divider>

      <members-group
        title="Dimension"
        [members]="query.dimensions.asArray()"
        [allMembers]="builderMeta.dimensions"
        (onSelect)="query.dimensions.add($event)"
        (onMemberClick)="query.dimensions.remove($event)"
      ></members-group>

      <mat-divider [vertical]="true"></mat-divider>

      <members-group
        title="Segment"
        [members]="query.segments.asArray()"
        [allMembers]="builderMeta.segments"
        (onSelect)="query.segments.add($event)"
        (onMemberClick)="query.segments.remove($event)"
      ></members-group>

      <time-group
        [timeDimensionMember]="query.timeDimensions"
        [members]="query.timeDimensions.asArray()"
        [allMembers]="builderMeta.timeDimensions"
      ></time-group>
    </div>

    <div class="controls-row">
      <mat-form-field appearance="fill">
        <mat-icon matPrefix style="margin-right: 8px;">{{
          chartTypeMap[queryBuilder.chartType] || 'multiline_chart'
        }}</mat-icon>

        <mat-label>Chart Type</mat-label>
        <mat-select
          [value]="queryBuilder.chartType"
          (selectionChange)="queryBuilder.setChartType($event.value)"
        >
          <mat-select-trigger *ngIf="queryBuilder.chartType" matPrefix>
            {{ queryBuilder.chartType | titlecase }}
          </mat-select-trigger>

          <mat-option
            *ngFor="let item of chartTypeToIcon"
            [value]="item.chartType"
          >
            <span matPrefix>
              <mat-icon>{{ item.icon }}</mat-icon>
            </span>
            {{ item.chartType | titlecase }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <button mat-button mat-raised-button (click)="openDialog()">
        <mat-icon>settings</mat-icon>
        Settings
      </button>
    </div>
  </div>

  <button mat-button (click)="debug()">debug</button>

  <button mat-button mat-stroked-button (click)="setQuery()">
    set/reset query
  </button>

  <query-renderer
    [queryBuilder]="queryBuilder"
    [chartType]="queryBuilder.chartType"
    [pivotConfig]="queryBuilder.pivotConfig.get()"
  ></query-renderer>

  <!-- <div class="debug">{{ query.asCubeQuery() | json }}</div> -->
</div>
